<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ - Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --sec-blue:#005a8f; --sec-orange:#f28b00; --bg:#f4f7f9; }
        *{box-sizing:border-box;font-family:'Cairo',sans-serif}
        body{background:var(--bg);margin:0;padding-bottom:90px}

        #loginOverlay{
            position:fixed;inset:0;
            background:linear-gradient(135deg,var(--sec-blue),#003a5d);
            display:flex;align-items:center;justify-content:center;
            z-index:10000
        }
        .login-card{
            background:#fff;padding:30px;border-radius:20px;
            width:90%;max-width:420px;text-align:center;
            box-shadow:0 20px 40px rgba(0,0,0,.3);
            border-top:6px solid var(--sec-orange)
        }
        .logo-hero{width:170px;margin-bottom:15px}
        .sub-title-archive{
            color:var(--sec-blue);font-size:14px;font-weight:bold;
            border-top:1px solid #eee;padding-top:10px;display:block
        }

        .header{
            background:#fff;padding:10px 15px;
            border-bottom:4px solid var(--sec-orange);
            position:sticky;top:0;z-index:1000;
            display:flex;justify-content:space-between;align-items:center;
            box-shadow:0 2px 10px rgba(0,0,0,.1)
        }
        .header-right{display:flex;gap:10px;align-items:center}
        .header-left-box{
            border:2px solid var(--sec-blue);
            padding:5px 10px;border-radius:8px;
            font-size:11px;font-weight:bold;color:var(--sec-blue);
            background:#f8fafc;text-align:center
        }
        .inspector-name{font-size:12px;font-weight:bold;color:var(--sec-blue)}

        .container{max-width:700px;margin:20px auto;padding:0 15px;display:none}
        .card{
            background:#fff;border-radius:15px;padding:20px;
            margin-bottom:15px;box-shadow:0 4px 6px rgba(0,0,0,.05);
            border-right:5px solid var(--sec-blue)
        }
        input,textarea{
            width:100%;padding:12px;margin:8px 0;
            border:1px solid #ddd;border-radius:10px;
            font-size:14px
        }

        .opt-grid{
            display:grid;grid-template-columns:repeat(3,1fr);
            gap:10px;margin-top:10px
        }
        .opt-btn{
            background:#f1f5f9;padding:12px 5px;
            border-radius:8px;cursor:pointer;
            font-size:11px;font-weight:bold;
            display:flex;align-items:center;justify-content:center;
            min-height:55px;border:2px solid transparent
        }
        input[type=radio]{display:none}
        input:checked+.ok{background:#dcfce7;color:#166534;border-color:#22c55e}
        input:checked+.no{background:#fee2e2;color:#991b1b;border-color:#ef4444}
        input:checked+.na{background:#e2e8f0;color:#475569;border-color:#94a3b8}

        .attachment-box{
            display:none;background:#fffcf5;
            padding:15px;border-radius:10px;
            border:1px dashed var(--sec-orange);margin-top:10px
        }

        .footer{
            position:fixed;bottom:0;width:100%;
            background:#fff;padding:15px;text-align:center;
            box-shadow:0 -5px 15px rgba(0,0,0,.1)
        }
        .submit-btn{
            background:var(--sec-blue);color:#fff;
            padding:15px;border:none;border-radius:12px;
            font-size:18px;font-weight:bold;width:90%
        }
    </style>
</head>

<body>

<div id="loginOverlay">
    <div class="login-card">
        <img src="imeg/imge.jpg" class="logo-hero">
        <div style="color:var(--sec-blue);font-weight:bold">
            Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡<br>
            <small style="color:var(--sec-orange)">Ù†Ø¸Ø§Ù… ØªÙØªÙŠØ´ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ</small>
            <span class="sub-title-archive">( Ø£Ø±Ø´ÙØ© Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠÙŠÙ† Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø¹Ù…Ù„ )</span>
        </div>
        <input id="uid" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input id="ups" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button onclick="doLogin()" style="width:100%;padding:15px;background:var(--sec-blue);color:#fff;border:none;border-radius:10px">Ø¯Ø®ÙˆÙ„ ğŸš€</button>
        <p id="lErr" style="display:none;color:red">âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©</p>
    </div>
</div>

<div id="mainApp" class="container">
    <div class="header">
        <div class="header-right">
            <img src="imeg/imge.jpg" style="height:45px">
            <div>
                <span id="inspectorLabel" class="inspector-name"></span><br>
                <span onclick="logout()" style="color:red;font-size:10px;cursor:pointer">ğŸšª Ø®Ø±ÙˆØ¬</span>
            </div>
        </div>
        <div class="header-left-box">Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©<br>Ø¥Ø¯Ø§Ø±Ø© Ø¶ÙˆØ§Ø­ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</div>
    </div>

    <form id="safetyForm">

        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
        <div class="card" style="margin-top:20px">
            <h3 style="color:var(--sec-blue)">ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…</h3>

            <!-- Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ -->
            <input type="date" id="rDate" name="report_date" required>
            <input type="text" name="contractor_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„" required>
            <input type="text" name="receiver_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…" required>

            <input type="text" name="location" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹ / Ø§Ù„Ù…Ø­Ø·Ø©" required>
            <input type="text" name="district" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ù‰" required>
            <input type="text" name="team_name" placeholder="Ø§Ø³Ù… ÙØ±ÙŠÙ‚ Ø§Ù„Ø²ÙŠØ§Ø±Ø©" required>
            <input type="text" name="supervisor_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù" required>
            <input type="text" name="job_order" placeholder="Ø±Ù‚Ù… Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„ / Ø§Ù„Ù…Ù‚Ø§ÙŠØ³Ø©" required>
            <input type="text" name="work_desc" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„" required>
        </div>

        <div id="questionsContainer"></div>

        <div class="footer">
            <button class="submit-btn" id="sBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ âœ…</button>
        </div>
    </form>
</div>

<script>
const REDIS_URL="https://exact-parakeet-58043.upstash.io";
const REDIS_TOKEN="AeK7AAIncDFmOTAzMGJlOTM5Y2I0ZTFjYTg4ODRhOWIyNjJmZWMwY3AxNTgwNDM";

const qList=["* ØªØµØ±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ø«Ø§Ù†ÙˆÙŠ Ù…ØªÙˆØ§Ø¬Ø¯ Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„","* Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ø¹Ù…Ù„ Ù…ØªÙˆØ§Ø¬Ø¯ Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„","* Ù…Ù„Ø§Ø­Ø¸Ø§Øª"];

async function doLogin(){
    const u=uid.value,p=ups.value;
    try{
        const r=await fetch(`${REDIS_URL}/get/user:${u}`,{headers:{Authorization:`Bearer ${REDIS_TOKEN}`}});
        const d=await r.json();
        if(d.result===p){sessionStorage.setItem("inspector",u);startApp(u)}
        else lErr.style.display="block";
    }catch{alert("Ø®Ø·Ø£ Ø§ØªØµØ§Ù„")}
}

function startApp(u){
    loginOverlay.style.display="none";
    mainApp.style.display="block";
    inspectorLabel.innerText="Ø§Ù„Ù…ÙØªØ´: "+u;
    rDate.valueAsDate=new Date();
    loadQuestions();
}

function loadQuestions(){
    let h="";
    qList.forEach((q,i)=>{
        const n=i+1;
        h+=`
        <div class="card">
            <b>${n}. ${q}</b>
            <div class="opt-grid">
                <label><input type="radio" name="q${n}" value="Ù†Ø¹Ù…" required onclick="showAttach(${n})"><div class="opt-btn ok">Ù†Ø¹Ù…</div></label>
                <label><input type="radio" name="q${n}" value="Ù„Ø§" onclick="showAttach(${n})"><div class="opt-btn no">Ù„Ø§</div></label>
                <label><input type="radio" name="q${n}" value="Ù„Ø§ ÙŠÙ†Ø·Ø¨Ù‚" onclick="showAttach(${n})"><div class="opt-btn na">Ù„Ø§ ÙŠÙ†Ø·Ø¨Ù‚</div></label>
            </div>
            <div class="attachment-box" id="abox${n}">
                <textarea id="note${n}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©"></textarea>
            </div>
        </div>`;
    });
    questionsContainer.innerHTML=h;
}

function showAttach(i){document.getElementById("abox"+i).style.display="block"}

safetyForm.onsubmit=async e=>{
    e.preventDefault();
    sBtn.disabled=true;
    const fd=new FormData(e.target);
    const id=Date.now();

    const report={
        serial:id,
        inspector:sessionStorage.getItem("inspector"),
        timestamp:new Date().toLocaleString("ar-EG"),
        contractor_name:fd.get("contractor_name"),
        receiver_name:fd.get("receiver_name"),
        location:fd.get("location"),
        district:fd.get("district"),
        team_name:fd.get("team_name"),
        supervisor_name:fd.get("supervisor_name"),
        job_order:fd.get("job_order"),
        work_desc:fd.get("work_desc"),
        answers:{}
    };

    qList.forEach((_,i)=>report.answers[i+1]=fd.get("q"+(i+1)));

    await fetch(`${REDIS_URL}/set/report:${id}`,{
        method:"POST",
        headers:{Authorization:`Bearer ${REDIS_TOKEN}`},
        body:JSON.stringify(report)
    });

    alert("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
    location.reload();
};

function logout(){sessionStorage.clear();location.reload()}
</script>

</body>
</html>
.
